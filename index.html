<!--    
* SysExplorer - A System Explorer for the blockchain of Minima
        
* @eliasnem
   
* Created on 27/08/2020. 
-->

<!DOCTYPE html>
    
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>SysExplorer</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" 
              integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" 
              crossorigin="anonymous">              
        <link rel="stylesheet" href="css/styles.css">


    </head>
    <body>
        <div class="m-2 text-center">
            
            <!-- TITLE -->

            <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
                <div class="navbar-brand">
                    <a href="#" class="navbar-brand">
                        <h5 class="title ml2"> Minima's System Explorer. </h5>
                    </a>
                </div>
                <button class="navbar-toggler" 
                        type="button" 
                        data-toggle="collapse" 
                        data-target="#navbarToggler" 
                        aria-controls="navbarToggler" 
                        aria-expanded="false" 
                        aria-label="Toggle Navigation">
                    
                    <span class="navbar-toggler-icon"></span>
                    </button>

                <div class="collapse navbar-collapse" id="navbarToggler">
                    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                        
                        <li class="nav-item active">
                          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                        </>
                        <li class="nav-item dropdown">
                            <a href="" class="nav-link dropdown-toggle" href="#" id="charts-dd" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Charts
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="charts-dd">
                                <li class="dropdown-header">Line charts</li>
                                <li><a href="#" class="dropdown-item">Blocks/Time Chart</a></li>
                                <li><a href="#" class="dropdown-item">Hashrate/speed Chart</a></li>
                                <li><a href="#" class="dropdown-item">Another Chart</a> </li>
                            </ul>
                        </li>
                      </ul>
                </div>
            </nav>


            <!-- welcoming ALERT -->
            <div class="alert alert-warning alert-dismissible fade show mb-5" role="alert">
                <strong>Welcome to Minima's System Explorer.</strong> If you haven't joined our telegram, join <a href="https://t.me/Minima_Global" class="alert-link" target="_blank">here</a>.
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>


        
            <div class="container">
                <div class="jumbotron" style="padding: 4rem 1rem !important;"> <!-- hardcoded for fix of header flying around on xs -->
                    
                    <h2 class="stats ">
                        Stats.
                    </h2>
                    
                    <div class="row">

                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                            <div class="card" style="width: 18rem;">

                                
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 stats-blocks">
                            <div class="card card4blocks">

                                <div class="lead">Blocks Mined</div>

                                <div class="img rounded m-2">
                                    <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-intersect" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M0 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2H2a2 2 0 0 1-2-2V2zm5 10v2a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2v5a2 2 0 0 1-2 2H5zm6-8H6a2 2 0 0 0-2 2v5H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v2z"/>
                                      </svg>
                                </div>

                                
                                <div class="card-text" id="blocks-mined"></div>

                                <div class="card-subtitle mt-2 lead">
                                    Current height number of the chain.
                                </div>

                                

                            </div>

                            <div class="middle">
                                <a href="#" class="mid-text btn btn-info">See Chart</a>
                            </div>
                        
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                            <div class="card">

                            </div>
                        </div>

                    </div>

                </div>
            </div>

            
            
            <!-- Charts -->
            <div class="m-5">
                <div class="card col-md-6 offset-md-3 blk-card">
                    <canvas id="blocks-canvas"></canvas>
                </div>
            </div>




            <!-- Use this for loading -->
            <!-- <div class="spinner">
                <div class="cube1"></div>
                <div class="cube2"></div>
            </div> -->
                
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js" integrity="sha512-rmZcZsyhe0/MAjquhTgiUcb4d9knaFc7b5xAfju483gbEXTkeJRUMIPk6s3ySZMYUHEcjKbjLjyddGWMrNEvZg==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg==" crossorigin="anonymous"></script>
        <script>
            var ctx = document.getElementById('blocks-canvas').getContext('2d');
            var blocks = [];
            var timestamp = [];

            function addData(tstamp, blknum) {
                
                tstamp = moment(tstamp*1000); // convert tstamp to ms, then convert to date
                
                chart.data.labels.push(tstamp); // add new block timestamp to array
                chart.data.datasets[0].data.push(blknum); // add new block to array
                chart.update(); // re-render chart

                // Check if too much data, then concatenate
                if(chart.data.datasets[0].data.length > 20) {
                    chart.data.datasets[0].data.shift();
                }
                if(chart.data.labels.length > 25) {
                    chart.data.labels.shift();
                }

            }
            
            var chart = new Chart(ctx, {

                type: 'line',
                data: {
                    labels: [], // xAxes labels; use this for block's timestamp
                    datasets:[{
                        label:'Block Number',
                        data: [], // yAxes data, this is the block number
                        backgroundColor: 'rgb(70,72,97, 0.9)',
                        borderColor: 'rgb(246,102,29, 0.9)',
                        borderWidth: 1,
                        pointStyle: 'rectRounded',
                    }]                     
                },
                options: {
                    title: {
                        display: true,
                        text: 'Block/Time Chart',
                        fontColor: 'rgb(70, 72, 97, 0.9)',
                        fontSize: 12
                    },
                    scales: {
                        xAxes: [{
                            type: 'time',
                            time: {
                                unit: 'seconds',
                                unitStepSize: 100,
                                displayFormats: {
                                    seconds: 'h:mm:ss a'
                                }
                            }
                        }],
                        yAxes: [{
                            type: 'linear',
                            ticks: {
                                stepSize: 5
                            }
                        }]
                    },
                    legend: {
                        display: true,
                        position: 'bottom',
                        reverse: true,
                        labels: {
                            boxWidth: 25,
                            fontSize: 10,
                            padding: 20,
                            usePointStyle: true
                        }
                    }
                }

            });
        </script>
        <!-- Minima Script -->
        <script type="text/javascript">

            

            // Minima Event Manager
            window.addEventListener("load", function(){
                window.addEventListener("MinimaEvent", function(evt){
                    // Deal with each message type. 
                    if(evt.detail.event === "connected"){
                        console.log("@M: Connection Successful.");
                    } else if(evt.detail.event === "newblock"){
                        console.log("@Minima: New block.");
                        // Add blocks to block/time chart

                        $(document).ready(function(){

                            document.getElementById('blocks-mined').innerText = Minima.block;
                            document.getElementById('chain-speed').innerText = Minima.status.chainspeed;
                            document.getElementById('uptime').innerText = Minima.status.uptime;

            
                        });

                        var timestamp = "";
                        Minima.cmd("txpowinfo "+Minima.status.tip, function(res){
                            if(res.status){
                                timestamp = res.response.txpow.header.timesecs;
                                
                                addData(timestamp, Minima.block);

                            }
                        });

                    } else if(evt.detail.event === "newbalance"){
                        console.log("@M: Balance update.")
                    }
                });
                Minima.init();
            });

            // Create a SQL Table. 
            function initSQL(){
                Minima.sql("CREATE TABLE IF NOT EXISTS blockvstime (height VARCHAR(160) NOT NULL, timestamp VARCHAR(160); SELECT DISTINCT height, timestamp FROM blockvstime", function(resp){
                    if(!resp.status){
                        console.log("@M: SQL ERROR!");
                    }
                });
            }
            // Populate blocks and timestamps arrays
            function populateArr(){

            }
            
    
        </script>

        <script src="" async defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
        <script>
            /*
                Tobias Sahlin Sick Animations
                https://tobiasahlin.com/moving-letters/#1/
            */
            // Wrap every letter in a span
            var textWrapper = document.querySelector('.ml2');
            textWrapper.innerHTML = textWrapper.textContent.replace(/\S/g, "<span class='letter'>$&</span>");
    
            anime.timeline({loop: true})
            .add({
                targets: '.ml2 .letter',
                scale: [4,1],
                opacity: [0,1],
                translateZ: 0,
                easing: "easeOutExpo",
                duration: 950,
                delay: (el, i) => 70*i
            }).add({
                targets: '.ml2',
                opacity: 0,
                duration: 1000,
                easing: "easeOutExpo",
                delay: 10000
            });
            </script>
        <script src="js/minima.js" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
       
    </body>
</html>
